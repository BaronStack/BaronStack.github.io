{"title":"C++面试问题准备：如何实现守护进程","slug":"C-面试问题准备：如何实现守护进程","date":"2018-03-11T11:27:06.000Z","updated":"2018-03-12T01:36:58.000Z","comments":true,"path":"api/articles/C-面试问题准备：如何实现守护进程.json","photos":[],"link":"","excerpt":"守护进程守护进程也称精灵进程(Daemon)，是运行在后台的一种特殊进程。它独立于控制终端并且周期性的执行某种任务或等待处理某些发送的事件。Linux上的大多数服务器就是用守护进程实现的。","covers":["/images/linuxImages/deamon.png"],"content":"<h3 id=\"守护进程\"><a href=\"#守护进程\" class=\"headerlink\" title=\"守护进程\"></a>守护进程</h3><p>守护进程也称精灵进程(Daemon)，是运行在后台的一种特殊进程。它独立于控制终端并且周期性的执行某种任务或等待处理某些发送的事件。Linux上的大多数服务器就是用守护进程实现的。 <a id=\"more\"></a></p>\n<blockquote>\n<p>守护进程可以解决产生死锁的一个必要条件，资源独占问题。即可以实现间接线程资源共享，对于打印机来说我们不允许任何线程直接占有，而是设计一个”精灵程序”（守护进程）来管理。这个进程独占打印机，所有的打印任务都由它发出，任何一个线程想要打印，不是直接请求打印机，而是将打印要求发给这个守护进程指定的地方，这个守护进程将负责完成任务打印。</p>\n</blockquote>\n<p>Linux系统启动时会启动很多系统服务进程，这些系统服务进程没有控制终端，不能直接和用户交互。其他进程启东市都是在用户登录或运行程序是创建，在运行结束或用户注销时终止，但系统服务进程不受用户登录注销影响，他们一直运行着。这种进程就叫做守护进程(精灵进程)（Deamon）。 </p>\n<p>如下图，一般守护进程会在程序运行名后面多一个d,但不是所有尾字母是d的都是守护进程。</p>\n<p><img src=\"/images/linuxImages/deamon.png\" alt=\"\"></p>\n<h3 id=\"创建守护进程\"><a href=\"#创建守护进程\" class=\"headerlink\" title=\"创建守护进程\"></a>创建守护进程</h3><figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;unistd.h&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">pid_t</span> setsid(<span class=\"keyword\">void</span>); <span class=\"comment\">//setid()创建成功后返回新建的会话ID，出错返回-1;</span></span><br></pre></td></tr></table></figure>\n<p>所以我们在调用setsid()函数之前，必须先fork()创建父子进程，父子进程在同一个进程组中，父进程是组长进程，所以子进程符合条件，将父进程退出即可满足要求； </p>\n<p>步骤：</p>\n<p>1、调用umask()将文件模式创建屏蔽字设置为0；<br>2、调用fork，父进程退出。//1、保证守护进程不是进程组长<br>3、调用setsid创建一个会话。//setsid会导致：1、调用进程成为新会话的首进程，2、调用进程成为一个进程组的组长进程，3、调用进程没有控制终端。<br>4、将当前工作目录更改我根目录。//系统中除了跟目录都可以被删除<br>5、关闭不在需要的文件描述符<br>6、忽略SIGCHLD信号；</p>\n","categories":[{"name":"面试","slug":"面试","count":32,"path":"api/categories/面试.json"}],"tags":[{"name":"OS","slug":"OS","count":3,"path":"api/tags/OS.json"}]}