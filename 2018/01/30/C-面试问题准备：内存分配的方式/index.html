<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Mr.张">
  <!-- Open Graph Data -->
  <meta property="og:title" content="C++ 面试问题准备：内存分配的方式"/>
  <meta property="og:description" content="" />
  <meta property="og:site_name" content="那一刻 风情万种"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://yoursite.com"/>
  
    <link rel="alternate" href="/atom.xml" title="那一刻 风情万种" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>那一刻 风情万种</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.dark.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">C++ 面试问题准备：内存分配的方式</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="/categories">
                  
                  categories
                  
                </a>
              </li>
            
              <li>
                <a href="/tags">
                  
                  tags
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/BaronStack">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="/2689496754@qq.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
          <span id="busuanzi_container_site_uv">
          本站访客数<span id="busuanzi_value_site_uv"></span>人次
          </span>
            <!-- Author -->
            <span class="author info">By Mr.张</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2018-01-30</span>
            <span class="time">11:38:05</span>
          </span>
          

          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/面试/">面试</a>
</span>
          
      </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/C/">#C++</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <h3 id="C-中常见内存分配及其存储区域有以下几种"><a href="#C-中常见内存分配及其存储区域有以下几种" class="headerlink" title="C++ 中常见内存分配及其存储区域有以下几种"></a>C++ 中常见内存分配及其存储区域有以下几种</h3><ul>
<li>堆分配</li>
<li>栈分配</li>
<li>自由存储区</li>
<li>静态存储区</li>
<li>常量存储区<a id="more"></a></li>
</ul>
<p>这里首先描述以下除了堆和栈的三种存储方式：</p>
<h4 id="自由存储区"><a href="#自由存储区" class="headerlink" title="自由存储区"></a>自由存储区</h4><p>这个存储区是单独为C++ 中<code>new</code>运算符提出来的，该存储区是<code>new</code>和<code>delete</code>动态分配和释放对象的抽象概念。在《STL 源码剖析中》自由存储区是利用allocate空间配置器进行STL操作对象的空间分配，通过allocate ,deallocate,construct,destroy进行空间的分配和释放。详细可以参考文章<a href="http://vigortyy.com/2018/01/27/C-开发面试准备：STL-allocator/" target="_blank" rel="noopener">STL allocator</a></p>
<blockquote>
<p>别将自由存储区与堆分配等价，堆是由操作系统进行维护的一片内存区域</p>
</blockquote>
<h4 id="静态存储区"><a href="#静态存储区" class="headerlink" title="静态存储区"></a>静态存储区</h4><p>全局变量和静态变量的存储是放在同一块区域，初始化的静态变量和全局变量在一块，未初始化的在另一块，程序运行结束后由系统自动释放。</p>
<h4 id="常量存储区"><a href="#常量存储区" class="headerlink" title="常量存储区"></a>常量存储区</h4><p>这是一块比较特殊的存储区，是固化在执行文件上的数据，里面存放的是常量，不允许被修改。</p>
<p><strong>接下来我们看看堆和栈的区别</strong></p>
<ol>
<li><p>内存分配：</p>
<p> 堆：一般由程序员分配释放，若程序员不释放，程序结束后会由操作系统进行释放（这里主要是指局部变量使用堆分配的方式）。它的分配方式类似与链表，常用的关键字是：malloc,free</p>
<p> 栈：由系统自动飞配，结束后系统自动释放（局部变量）</p>
</li>
<li><p>申请方式：</p>
<p> 堆：需要程序员自己申请，并指明大小。</p>
<p> 栈：系统自动分配</p>
</li>
<li><p>大小限制：</p>
<p> 堆：是向高地址扩展的数据结构，是不连续的内存区域。这是由于系统是用链表来存储的空闲内存地址的，自然是不连续的，而链表的遍历方向是由低地址向高地址。堆的大小受限于计算机系统中有效的虚拟内存。由此可见，堆获得的空间比较灵活，也比较大</p>
<p> 栈：在Windows下, 栈是向低地址扩展的数据结构，是一块连续的内存的区域。栈的大小是固定的（是一个编译时就确定的常数），如果申请的空间超过栈的剩余空间时，将提示overflow。因此，能从栈获得的空间较小。</p>
</li>
<li><p>效率方面：</p>
<p> 堆：分配空间需要使用malloc以及用free释放，这个过程需要调用操作系统的函数，由操作系统通过一定的内存分配算法分配空间，最后才由汇编器翻译为指令执行，效率较低。但是会造成大量的内存碎片，如果不合理进行释放，会导致系统运行缓慢甚至崩溃</p>
<p> 栈：栈是机器系统的数据结构，由与在操作系统中有栈操作的指令，所以执行起来较快。</p>
</li>
<li><p>存放内容方面：</p>
<p> 堆：一般情况堆顶使用一个字节的空间来存放堆的大小，而堆中具体存放内容是由程序员来完成的</p>
<p> 栈：栈存放的内容，一般来说是函数地址和相关参数。</p>
<blockquote>
<p>这里关于在栈中，函数调用过程栈帧的变化大家可以参考这篇文章<a href="http://blog.csdn.net/qq_29403077/article/details/53205010" target="_blank" rel="noopener">函数调用过程栈帧变化详解</a>.<strong>总之就是将控制进行跳转，同时对于控制中用到的变量以及函数地址分配相应的栈空间。</strong></p>
</blockquote>
</li>
</ol>
<p>这里是一些外国人的博客对于堆栈的描述</p>
<p><a href="http://www.learncpp.com/cpp-tutorial/79-the-stack-and-the-heap/" target="_blank" rel="noopener">The stack and the heap</a></p>
<p><a href="https://salilkapur.wordpress.com/2013/04/11/stack-memory-vs-heap-memory-in-cc/" target="_blank" rel="noopener">STACK MEMORY VS HEAP MEMORY IN C/C++</a></p>
<p>个人感觉写的比较浅，当然常用到的主要区别都写到了</p>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
          <span id="busuanzi_container_page_uv">本文总阅读量<span id="busuanzi_value_page_pv"></span>次</span>
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

